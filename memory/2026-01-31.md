# 2026-01-31

## Home Assistant integration
- Added a workspace skill `skills/homeassistant/` with a small Python helper (`ha.py`) to call HA REST endpoints.
- HA connectivity configured via OpenClaw config env injection (`skills.entries.homeassistant.env.HA_URL/HA_TOKEN`).
- Note: HA token was shared via chat; recommended to revoke and re-issue.
- Voice intent mapping preference:
  - When user says “увімкни/вимкни світло в ванні/ванній”, control:
    - `switch.bath_mirror_switch_switch_1` (switch.turn_on / switch.turn_off)
  - Older automations `automation.turn_bath_mirror_on/off` were less reliable.

## Shopping list automation
- Canonical shopping list: `/Users/mk/clawd/shopping-list.md`.
- Requirement: every Saturday at 10:00 (Europe/Berlin), ensure items exist even if deleted during the week:
  - "червона риба солона"
  - "авокадо"
- Implemented via macOS LaunchAgent (launchd):
  - Script: `/Users/mk/clawd/scripts/shopping_list_weekly_staples.py`
  - LaunchAgent: `ai.openclaw.shopping-list-weekly-staples`
  - Logs: `/tmp/openclaw-shopping-list-weekly-staples.out.log` + `.err.log`

## LaunchAgents repo-first approach (restore-friendly)
- Default approach:
  - Scripts in repo: `/Users/mk/clawd/scripts/`
  - LaunchAgent plists in repo: `/Users/mk/clawd/launchagents/`
  - Install via symlink into `~/Library/LaunchAgents/`
  - Secrets OUT of git: `~/.openclaw/secrets/secrets.env` (chmod 600)
  - Prefer iCloud Keychain as source-of-truth; regenerate `secrets.env` when needed.
  - Reinstall via: `bash /Users/mk/clawd/launchagents/install.sh`

## Keychain-backed secrets
- Added scripts:
  - `/Users/mk/clawd/scripts/secrets_env_from_keychain.sh` (safe, won’t overwrite secrets.env if Keychain missing items unless --force)
  - `/Users/mk/clawd/launchagents/update-secrets-from-keychain.sh`
- Keychain convention:
  - Generic Password
  - service: `openclaw/<ENV_KEY>`
  - account: `mk`
- Confirmed secrets written into iCloud Keychain and can be regenerated into `~/.openclaw/secrets/secrets.env`.

## Services status + diagnostic outcomes (Gmail + hooks)
- OpenClaw gateway: running on `http://127.0.0.1:18789/`.
- Hooks: enabled (`hooks.enabled=true`).
  - `GET /hooks/...` returns 405 (expected; Allow: POST).
  - `POST /hooks/gmail-personal` with dummy payload returns 400 (expected; mapping expects a specific message payload).
- Root issue found: duplicate Gmail watchers for personal account:
  - OpenClaw has a built-in gmail watcher that starts `gog gmail watch serve` on 8788 if hooks.gmail is configured.
  - We also had an external LaunchAgent `com.mk.gog.gmail-personal-serve` using 8788.
  - This caused port conflicts (“address already in use”) and unstable behavior.
- Fix applied: personal watcher should be run ONLY by OpenClaw gateway; keep external personal watcher LaunchAgent disabled to avoid conflicts.
- Work watcher pipeline:
  - `com.mk.gog.gmail-work-serve` listens on 8789 and posts to `gmail-drafter` (`http://127.0.0.1:18990/gmail-work`).
  - `gmail-drafter` auth check via bearer token returns 200.
  - Remaining issue: `com.mk.gog.gmail-work-serve` occasionally logs `context canceled` posting to gmail-drafter, and sometimes `invalid push payload: missing message.data`.
  - Next step: deep diagnostic of work watcher -> gmail-drafter (capture actual hook request, confirm headers, and identify why context canceled happens).

## Telegram bot setup
- Bot: `@mkravch_bot`
- Group allowlist:
  - `-1003898983945` ("Батьки і ШІ")
  - `-5047651066` ("Люся та ШІ")
- DM allowlist:
  - `402628226`
- Mention not required in those groups (`requireMention=false`).

## Repo-friendly config + Keychain
- Saved secrets (incl. `TELEGRAM_BOT_TOKEN`) into iCloud Keychain (service `openclaw/<KEY>`, account `mk`).
- Added reverse sync script: `scripts/secrets_keychain_from_env.sh`.
- Updated `scripts/secrets_env_from_keychain.sh` to include `TELEGRAM_BOT_TOKEN`.
- Generated repo-friendly OpenClaw config template: `config/openclaw.example.json` (uses `${ENV_VAR}` placeholders).
- Added docs: `docs/secrets-and-config.md`.
- Memory rule: before restart write unfinished items to `memory/pending-after-restart.md`, after restart check+finish+report.

## Home: gold picture dimensions
- Gold picture ("золота картина") dimensions: 90 × 70 cm.
